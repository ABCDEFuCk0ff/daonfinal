<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Îã®Ïñ¥ ÌÄ¥Ï¶à</title>
    <link rel="stylesheet" href="style.css">
    <script src="word_data.js"></script>
    <style>
        /* ÌÄ¥Ï¶à ÌéòÏù¥ÏßÄ Ï†ÑÏö© Ïä§ÌÉÄÏùº */
        body { padding-bottom: 20px; }
        .quiz-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px 0;
            text-align: center;
        }
        
        .quiz-progress {
            font-size: 16px;
            color: #666;
            margin-bottom: 20px;
            text-align: right;
            padding-right: 10px;
        }

        .quiz-card {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 15px;
            padding: 30px 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .quiz-question {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 30px;
            color: #333;
            line-height: 1.4;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .quiz-option-btn {
            padding: 15px;
            font-size: 16px;
            background-color: #fff;
            border: 2px solid #eee;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            color: #555;
            text-align: left;
            width: 100%;
        }

        .quiz-option-btn:hover {
            background-color: #f9f9f9;
            border-color: #ccc;
        }

        /* Ï†ïÎãµ/Ïò§Îãµ Ïä§ÌÉÄÏùº (ÏûêÎ∞îÏä§ÌÅ¨Î¶ΩÌä∏Î°ú ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä Ïãú Ï†ÅÏö©) */
        .quiz-option-btn.correct {
            background-color: #e8f5e9;
            border-color: #4caf50;
            color: #2e7d32;
            font-weight: bold;
        }

        .quiz-option-btn.wrong {
            background-color: #ffebee;
            border-color: #ef5350;
            color: #c62828;
        }

        .quiz-feedback {
            min-height: 24px;
            margin-top: 10px;
            font-weight: bold;
            font-size: 16px;
        }

        .quiz-timer-container {
            width: 100%;
            height: 10px;
            background-color: #eee;
            border-radius: 5px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .quiz-timer-bar {
            height: 100%;
            width: 100%;
            background-color: #007bff;
            transition: width 0.1s linear;
        }

        @media (max-width: 768px) {
            .quiz-option-btn {
                padding: 12px;
                font-size: 14px;
            }
            .quiz-question {
                font-size: 18px;
                margin-bottom: 20px;
            }
        }
        body.dark-mode .quiz-progress {
            color: #ccc;
        }
        body.dark-mode .quiz-timer-bar {
            background-color: #4caf50;
        }
    </style>
    <script>
        if (localStorage.getItem('theme') === 'dark') {
            document.documentElement.classList.add('dark-mode');
        }
    </script>
</head>
<body>
    <!-- Îí§Î°ú Í∞ÄÍ∏∞ Î≤ÑÌäº (ÌÄ¥Ï¶à Î©îÏù∏ÏúºÎ°ú Ïù¥Îèô) -->
    <a href="quiz.html" class="back-button">‚Üê</a>

    <main>
        <div class="page-header">
            <h1>Îã®Ïñ¥ ÌÄ¥Ï¶à</h1>
        </div>

        <div class="quiz-container">
            <!-- ÏßÑÌñâ ÏÉÅÌô© -->
            <div class="quiz-progress">
                Î¨∏Ï†ú <span id="current-index">1</span> / <span id="total-count">10</span>
            </div>
            <div class="quiz-timer-container">
                <div id="timer-bar" class="quiz-timer-bar"></div>
            </div>

            <!-- Î¨∏Ï†ú Ïπ¥Îìú -->
            <div class="quiz-card">
                <div class="quiz-question" id="question-text">
                </div>
                <div class="quiz-options" id="options-container"></div>
            </div>

            <!-- ÌîºÎìúÎ∞± Î©îÏãúÏßÄ -->
            <div class="quiz-feedback" id="feedback-msg"></div>

        </div>
    </main>

    <script>
        // bodyÏóê dark-mode ÌÅ¥ÎûòÏä§ Ï†ÅÏö©
        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
        }

        // ÏÑ†ÌÉùÎêú Ï£ºÏ†ú Í∞ÄÏ†∏Ïò§Í∏∞
        const selectedTopics = JSON.parse(localStorage.getItem('quizSelectedTopics')) || [];
        const currentLang = localStorage.getItem('selectedLanguage') || 'ÌïúÍµ≠Ïñ¥';

        if (selectedTopics.length === 0) {
            alert('ÏÑ†ÌÉùÎêú Îã®Ïñ¥ Î≤îÏúÑÍ∞Ä ÏóÜÏäµÎãàÎã§.');
            window.location.href = 'quiz.html';
        }

        // ÌÄ¥Ï¶à Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±
        const quizData = [];
        const targetQuestionCount = parseInt(localStorage.getItem('quizQuestionCount')) || (selectedTopics.length * 10);

        // ÏÑ†ÌÉùÎêú Ï£ºÏ†úÏùò Îã®Ïñ¥Îì§ ÏàòÏßë
        let availableWords = [];
        selectedTopics.forEach(topic => {
            if (wordDatabase[topic]) {
                availableWords = availableWords.concat(wordDatabase[topic]);
            }
        });

        // Ï†ÑÏ≤¥ Îã®Ïñ¥ Î™©Î°ù (Ïò§Îãµ Î≥¥Í∏∞ ÏÉùÏÑ±Ïö©)
        const allWords = Object.keys(wordDefinitions);

        // Î¨∏Ï†ú ÏÉùÏÑ± Î°úÏßÅ
        if (availableWords.length > 0) {
            for (let i = 0; i < targetQuestionCount; i++) {
                // Ï†ïÎãµ Îã®Ïñ¥ ÎûúÎç§ ÏÑ†ÌÉù
                const targetWord = availableWords[Math.floor(Math.random() * availableWords.length)];
                const correctDef = getDefinition(targetWord, currentLang);

                // Î≥¥Í∏∞ ÏÉùÏÑ± (Ï†ïÎãµ 1Í∞ú + Ïò§Îãµ 4Í∞ú)
                const options = [{ text: correctDef, isCorrect: true }];
                
                while (options.length < 5) {
                    const randomWord = allWords[Math.floor(Math.random() * allWords.length)];
                    if (randomWord !== targetWord) {
                        const wrongDef = getDefinition(randomWord, currentLang);
                        // Ï§ëÎ≥µÎêú Î≥¥Í∏∞Í∞Ä ÏóÜÎèÑÎ°ù ÌôïÏù∏
                        if (!options.some(o => o.text === wrongDef)) {
                            options.push({ text: wrongDef, isCorrect: false });
                        }
                    }
                }

                // Î≥¥Í∏∞ ÏÑûÍ∏∞
                options.sort(() => Math.random() - 0.5);

                quizData.push({
                    question: `'${targetWord}'Ïùò ÎúªÏúºÎ°ú ÏïåÎßûÏùÄ Í≤ÉÏùÄ?`,
                    options: options
                });
            }
        } else {
            alert('ÌïôÏäµÌï† Îã®Ïñ¥Í∞Ä ÏóÜÏäµÎãàÎã§.');
            window.location.href = 'quiz.html';
        }

        let currentQuestionIndex = 0;
        let isAnswered = false;
        let score = 0;
        let timerInterval;
        let quizResults = [];

        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const feedbackMsg = document.getElementById('feedback-msg');
        const currentIndexSpan = document.getElementById('current-index');
        const totalCountSpan = document.getElementById('total-count');

        function loadQuestion() {
            clearInterval(timerInterval);
            isAnswered = false;
            feedbackMsg.textContent = '';
            startTimer();

            const currentQuiz = quizData[currentQuestionIndex];
            currentIndexSpan.textContent = currentQuestionIndex + 1;
            totalCountSpan.textContent = quizData.length;

            questionText.textContent = currentQuiz.question;
            optionsContainer.innerHTML = '';

            currentQuiz.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'quiz-option-btn';
                btn.textContent = `${index + 1}. ${option.text}`;
                
                btn.onclick = () => {
                    if (isAnswered) return;
                    isAnswered = true;
                    clearInterval(timerInterval);

                    quizResults.push({
                        question: currentQuiz.question,
                        options: currentQuiz.options.map(o => o.text),
                        selected: index,
                        correct: currentQuiz.options.findIndex(o => o.isCorrect),
                        isCorrect: option.isCorrect
                    });

                    if (option.isCorrect) {
                        btn.classList.add('correct');
                        feedbackMsg.textContent = 'Ï†ïÎãµÏûÖÎãàÎã§! üëè';
                        feedbackMsg.style.color = '#2e7d32';
                        score++;
                    } else {
                        btn.classList.add('wrong');
                        feedbackMsg.textContent = 'Ïò§ÎãµÏûÖÎãàÎã§.';
                        feedbackMsg.style.color = '#c62828';
                        
                        // Ï†ïÎãµ ÌëúÏãú
                        const correctBtnIndex = currentQuiz.options.findIndex(o => o.isCorrect);
                        if (correctBtnIndex !== -1) {
                            optionsContainer.children[correctBtnIndex].classList.add('correct');
                        }
                    }
                    
                    // 0.3Ï¥à ÌõÑ Îã§Ïùå Î¨∏Ï†úÎ°ú ÏûêÎèô Ïù¥Îèô
                    setTimeout(() => {
                        currentQuestionIndex++;
                        if (currentQuestionIndex < quizData.length) {
                            loadQuestion();
                        } else {
                            localStorage.setItem('quizResults', JSON.stringify({
                                score: score,
                                total: quizData.length,
                                results: quizResults
                            }));
                            window.location.href = 'quiz_result.html';
                        }
                    }, 300);
                };
                optionsContainer.appendChild(btn);
            });
        }

        function startTimer() {
            let totalTime = 10;
            let timeLeft = totalTime;
            const timerBar = document.getElementById('timer-bar');
            timerBar.style.width = '100%';

            timerInterval = setInterval(() => {
                timeLeft -= 0.05;
                const percentage = (timeLeft / totalTime) * 100;
                timerBar.style.width = `${percentage}%`;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    handleTimeout();
                }
            }, 50);
        }

        function handleTimeout() {
            if (isAnswered) return;
            isAnswered = true;
            feedbackMsg.textContent = 'ÏãúÍ∞Ñ Ï¥àÍ≥º!';
            feedbackMsg.style.color = '#c62828';

            const currentQuiz = quizData[currentQuestionIndex];
            quizResults.push({
                question: currentQuiz.question,
                options: currentQuiz.options.map(o => o.text),
                selected: -1,
                correct: currentQuiz.options.findIndex(o => o.isCorrect),
                isCorrect: false
            });
            
            // Ï†ïÎãµ ÌëúÏãú
            const correctBtnIndex = currentQuiz.options.findIndex(o => o.isCorrect);
            if (correctBtnIndex !== -1) {
                optionsContainer.children[correctBtnIndex].classList.add('correct');
            }

            // ÏãúÍ∞Ñ Ï¥àÍ≥º ÏãúÏóêÎäî Ï†ïÎãµÏùÑ ÌôïÏù∏Ìï† Ïàò ÏûàÎèÑÎ°ù 1Ï¥à ÎåÄÍ∏∞
            setTimeout(() => {
                currentQuestionIndex++;
                if (currentQuestionIndex < quizData.length) {
                    loadQuestion();
                } else {
                    localStorage.setItem('quizResults', JSON.stringify({
                        score: score,
                        total: quizData.length,
                        results: quizResults
                    }));
                    window.location.href = 'quiz_result.html';
                }
            }, 1000);
        }

        // Ï≤´ Î¨∏Ï†ú Î°úÎìú
        loadQuestion();
    </script>
</body>
</html>