<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>즐겨찾기</title>
    <link rel="stylesheet" href="style.css">
    <script>
        if (!localStorage.getItem('isLoggedIn') && !localStorage.getItem('isGuest')) {
            window.location.href = 'index.html';
        }
    </script>
    <script>
        if (localStorage.getItem('theme') === 'dark') {
            document.documentElement.classList.add('dark-mode');
        }
    </script>
</head>
<body>
    <main>
        <header class="page-header">
            <a href="my-page.html" class="back-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
            </a>
            <h1>즐겨찾기</h1>
        </header>
        <div class="detail-content">
            <div id="guest-message" style="display: none; text-align: center; padding: 50px 0;">
                <p style="font-size: 18px; color: #666;">로그인이 필요한 기능입니다.</p>
                <button onclick="window.location.href='index.html'" class="start-button" style="margin-top: 20px; font-size: 14px; padding: 10px 20px;">로그인 하러 가기</button>
            </div>
            <div id="favorites-content">
            <div class="sort-container">
                <select id="sort-select" class="sort-select">
                    <option value="alpha">가나다순</option>
                    <option value="recent">최근 학습순</option>
                </select>
            </div>
            <div class="favorites-section">
                <h2>고전소설</h2>
                <div id="classical-novel-list" class="novel-grid"></div>
            </div>

            <div class="favorites-section">
                <h2>고전시</h2>
                <div id="classical-poetry-list" class="novel-grid"></div>
            </div>

            <div class="favorites-section">
                <h2>현대소설</h2>
                <div id="modern-novel-list" class="novel-grid"></div>
            </div>

            <div class="favorites-section">
                <h2>현대시</h2>
                <div id="modern-poetry-list" class="novel-grid"></div>
            </div>
            </div>
        </div>
    </main>

    <script>
        // body에 dark-mode 클래스 적용
        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
        }

        if (localStorage.getItem('isGuest')) {
            document.getElementById('favorites-content').style.display = 'none';
            document.getElementById('guest-message').style.display = 'block';
        } else {
        // 카테고리별 작품 목록 (분류용)
        const classicalNovels = ["춘향전", "심청전", "흥부전", "토끼전", "별주부전", "구운몽", "사씨남정기", "홍길동전", "전우치전", "운영전", "만복사저포기", "옥루몽", "김원전", "최고운전", "채봉감별곡", "배비장전", "박씨전", "숙향전", "조웅전", "적벽가", "유충렬전", "이생규장전", "창선감의록", "심생전", "장끼전", "서동지전", "숙영낭자전", "임경업전", "옹고집전", "금방울전", "정수정전", "상사동기", "이대봉전", "김진옥전", "이화전", "박태보전", "낙성비룡", "김현감호", "최척전", "임장군전"];
        const classicalPoetry = ["관동별곡", "사미인곡", "속미인곡", "어부사시사", "성산별곡", "청산별곡", "규원가", "면앙정가", "상춘곡", "도산십이곡", "고산구곡가", "누항사", "탄궁가", "거산호", "관서별곡", "농가월령", "장한가", "오륜가", "차마설", "고풍의상", "결빙의 아버지", "일동장유가", "북방에서 정현웅에게", "샛별 지자 종다리 떴다", "시비에 개 짓거늘", "논밭 갈아 기음 매고", "독자왕유희유오영", "어우가", "농가", "월훈", "청산행", "가지가 담을 넘을 때"];
        const modernNovels = ["관촌수필", "천변풍경", "난장이가 쏘아올린 작은 공", "삼대", "날개", "학", "소나기", "삼포 가는 길", "오발탄", "광장", "김약국의 딸들", "독 짓는 늙은이", "무녀도", "너와 나만의 시간", "평지", "자전거 도둑", "아주 느린 시간", "명랑한 밤길", "도도한 생활", "소리의 빛", "허생전", "허생의 처", "매우 잘생긴 우산 하나", "역로", "바위", "김서방전", "어머니", "비 오는 날이면 가리봉동에 가야 한다", "철없는 사람들", "인간시장", "태백산맥 (일부)", "우리들의 일그러진 영웅", "봄·봄", "산촌여정", "황진이", "카메라와 워커", "빈집", "길", "그 많던 싱아는 누가 다 먹었을까"];
        const modernPoetry = ["폭포", "산", "서시", "생명의 서", "별헤는 밤", "님의 침묵", "진달래꽃", "자화상", "또 다른 고향", "추억에서", "파밭 가에서", "살아있는 것은 흔들리면서 - 순례11", "내 마음의 고향6 - 초설", "멸치", "샤갈의 마을에 내리는 눈", "출생기", "강우", "벽", "눈물", "황혼", "불사조", "역사", "나목", "전라도 가시내", "들국", "흙", "느티나무로부터", "오래된 잠버릇", "어둠도 자세히 보면 환하다", "맨발", "풀벌레들의 작은 귀를 생각함", "배를 매며", "결빙의 아버지", "병원", "꽃씨", "산상의 노래", "성에꽃", "희망의 거처", "지리산 뻐꾹새", "아침 시"];

        // 문학 작품 즐겨찾기 로드 및 표시
        const favorites = JSON.parse(localStorage.getItem('learning_favorites')) || [];
        const completedList = JSON.parse(localStorage.getItem('learning_completed')) || [];
        const sortSelect = document.getElementById('sort-select');

        // 최근 학습 인덱스 찾기 헬퍼 함수
        function getCompletionIndex(title) {
            for (let i = completedList.length - 1; i >= 0; i--) {
                const item = completedList[i];
                const itemTitle = (typeof item === 'string') ? item : item.title;
                if (itemTitle === title) return i;
            }
            return -1;
        }
        
        function renderList(containerId, list, url) {
            const container = document.getElementById(containerId);
            let items = favorites.filter(title => list.includes(title));
            
            // 정렬 로직 적용
            const sortType = sortSelect.value;
            if (sortType === 'alpha') {
                items.sort((a, b) => a.localeCompare(b, 'ko'));
            } else if (sortType === 'recent') {
                items.sort((a, b) => {
                    const idxA = getCompletionIndex(a);
                    const idxB = getCompletionIndex(b);
                    if (idxA > -1 && idxB > -1) return idxB - idxA; // 둘 다 학습함: 최근 순
                    if (idxA > -1) return -1; // A만 학습함: A 우선
                    if (idxB > -1) return 1;  // B만 학습함: B 우선
                    return a.localeCompare(b, 'ko'); // 둘 다 안 함: 가나다순
                });
            }

            container.innerHTML = ''; // 기존 내용 초기화
            if (items.length === 0) {
                container.innerHTML = '<p class="no-data">즐겨찾기한 작품이 없습니다.</p>';
                container.style.display = 'block';
            } else {
                container.style.display = 'grid';
                items.forEach(title => {
                    const a = document.createElement('a');
                    a.href = `${url}?title=${encodeURIComponent(title)}`;
                    a.className = 'novel-button';
                    if (getCompletionIndex(title) > -1) {
                        a.classList.add('completed');
                    }
                    a.textContent = title;
                    container.appendChild(a);
                });
            }
        }

        function renderAllLists() {
            renderList('classical-novel-list', classicalNovels, 'novel_detail.html');
            renderList('classical-poetry-list', classicalPoetry, 'poetry_detail.html');
            renderList('modern-novel-list', modernNovels, 'modern_novel_detail.html');
            renderList('modern-poetry-list', modernPoetry, 'modern_poetry_detail.html');
        }

        // 초기 렌더링 및 이벤트 리스너 등록
        renderAllLists();
        sortSelect.addEventListener('change', renderAllLists);
        }
    </script>
</body>
</html>